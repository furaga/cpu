## -*- coding: utf-8 -*-
<%inherit file="skeleton.tmp"/>

entity ram is
<%include file="ram_entity.tmp"/>
end ram;

architecture behavior of ram is
	subtype ram_word is ${oc.ram_t()};
	type ram_array is array (0 to 4095) of ram_word;
	signal ram_data : ram_array;
	signal addr_in	: integer range 0 to 4096;


begin

	addr_in <= conv_integer(ADDR);
	process(CLK_MA)
	begin
		if (rising_edge(CLK_MA)) then
			if (RAM_WEN='1') then
				if (addr_in = 4096) then
					IO64_OUT <= DATA_IN;
				else 
					ram_data(addr_in) <= DATA_IN;
				end if;
			end if;
		end if;
	end process;

	process(RAM_WEN, addr_in, ram_data, IO65_IN)
	begin
		if (RAM_WEN='0') then
			if (addr_in = 4096) then
				DATA_OUT <= IO65_IN;
			else 
				DATA_OUT <= ram_data(addr_in);
			end if;
		end if;
	end process;
end behavior;
<%namespace name="oc" file="macro.tmp"/>

